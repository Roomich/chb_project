pipeline {
    agent { label "jenkins-agent" }
    // agent any

    options {
        buildDiscarder(logRotator(numToKeepStr: '10'))
        disableConcurrentBuilds()
        timestamps()
        ansiColor('xtrem')
    }

    environment {
        AWS_ACCESS_KEY_ID = credentials('accessKey')
        ASW_SECRET_ACCESS_KEY = credentials('secretKey')
        PROJECT_DIR = 'chb_project/terraform/infrastructure'
    }

    stages {
        stage ('Checkout SCM') {
            steps {
                checkout scmGit(branches: [[name: 'Buildapp']], extensions: [], userRemoteConfigs: [[credentialsId: 'github_ssh', url: 'git@github.com:Roomich/chb_project.git']])
            }
        }

        stage('Terraform init') {
            steps {
                dir(PROJECT_DIR) {
                    sh "terraform init -input=false"
                }
            }
        }
    }
}